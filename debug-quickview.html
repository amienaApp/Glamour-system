<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Quickview</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { 
            border: 2px solid #ddd; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
        }
        .product-card { 
            border: 1px solid #007bff; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
            background: #f8f9fa;
        }
        .quickview-sidebar {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            border-left: 1px solid #ddd;
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
        }
        .quickview-sidebar.active {
            right: 0;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        .overlay.active {
            display: block;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .debug-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>üîç Quickview Debug Page</h1>
    
    <div class="debug-section">
        <h2>üìã Test Instructions</h2>
        <ol>
            <li>Click "Test Quickview" button below</li>
            <li>Check the debug log for any errors</li>
            <li>Look at the browser console (F12) for more details</li>
            <li>Tell me what you see in both places</li>
        </ol>
    </div>
    
    <!-- Test Product Card -->
    <div class="product-card" 
         data-product-id="debug-123"
         data-product-name="Debug Test Product"
         data-product-price="99.99"
         data-product-sale-price="79.99"
         data-product-description="This is a debug test product"
         data-product-category="Debug"
         data-product-subcategory="Test"
         data-product-featured="true"
         data-product-on-sale="true"
         data-product-stock="50"
         data-product-rating="4.5"
         data-product-review-count="25"
         data-product-front-image="https://via.placeholder.com/300x400/ff6b6b/ffffff?text=Front"
         data-product-back-image="https://via.placeholder.com/300x400/4ecdc4/ffffff?text=Back"
         data-product-color="#ff6b6b"
         data-product-images='["https://via.placeholder.com/300x400/45b7d1/ffffff?text=Image1"]'
         data-product-color-variants='[{"color":"Red","value":"red","hex":"#ff6b6b","front_image":"https://via.placeholder.com/300x400/ff6b6b/ffffff?text=Red+Front","sizes":[{"size":"S","available":true,"stock":10},{"size":"M","available":true,"stock":15}]}]'
         data-product-sizes='[{"size":"S","available":true,"stock":18},{"size":"M","available":true,"stock":27}]'>
        
        <h3>Debug Test Product</h3>
        <p>Price: $99.99 (Sale: $79.99)</p>
        <p>Stock: 50</p>
        <p>Rating: 4.5 (25 reviews)</p>
        
        <button onclick="testQuickView('debug-123')" class="test-btn">
            üß™ Test Quickview
        </button>
        
        <button onclick="testDataExtraction()" class="test-btn">
            üîç Test Data Extraction
        </button>
        
        <button onclick="clearDebugLog()" class="test-btn">
            üóëÔ∏è Clear Log
        </button>
    </div>
    
    <!-- Debug Log -->
    <div class="debug-section">
        <h2>üìä Debug Log</h2>
        <div id="debug-log" class="debug-log">Debug log will appear here...</div>
    </div>
    
    <!-- Quick View Sidebar -->
    <div id="quick-view-sidebar" class="quickview-sidebar">
        <button class="close-btn" onclick="closeQuickView()">√ó</button>
        <h2 id="quick-view-title">Debug Quickview</h2>
        
        <div class="product-info">
            <div id="quick-view-price" class="price"></div>
            <div id="quick-view-sale-price" class="sale-price"></div>
            <div id="quick-view-description"></div>
            
            <h4>Images Found:</h4>
            <div id="quick-view-images"></div>
            
            <h4>Colors Found:</h4>
            <div id="quick-view-colors"></div>
            
            <h4>Sizes Found:</h4>
            <div id="quick-view-sizes"></div>
            
            <h4>Raw Data:</h4>
            <pre id="quick-view-raw-data"></pre>
        </div>
    </div>
    
    <!-- Overlay -->
    <div id="quick-view-overlay" class="overlay"></div>
    
    <script>
        // Debug logging function
        function log(message, type = 'info') {
            const logElement = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // Test data extraction
        function testDataExtraction() {
            log('Testing data extraction...', 'test');
            
            const productCard = document.querySelector('[data-product-id="debug-123"]');
            if (!productCard) {
                log('ERROR: Product card not found!', 'error');
                return;
            }
            
            log('Product card found, checking data attributes...', 'info');
            
            // Check all data attributes
            const attributes = [
                'data-product-id', 'data-product-name', 'data-product-price',
                'data-product-sale-price', 'data-product-description',
                'data-product-category', 'data-product-subcategory',
                'data-product-featured', 'data-product-on-sale',
                'data-product-stock', 'data-product-rating',
                'data-product-review-count', 'data-product-front-image',
                'data-product-back-image', 'data-product-color',
                'data-product-images', 'data-product-color-variants',
                'data-product-sizes'
            ];
            
            attributes.forEach(attr => {
                const value = productCard.getAttribute(attr);
                if (value) {
                    log(`‚úÖ ${attr}: ${value.substring(0, 50)}${value.length > 50 ? '...' : ''}`, 'success');
                } else {
                    log(`‚ùå ${attr}: MISSING`, 'error');
                }
            });
            
            log('Data extraction test complete', 'test');
        }
        
        // Test quickview function
        function testQuickView(productId) {
            log(`Testing quickview for product: ${productId}`, 'test');
            
            try {
                // Find the product card
                const productCard = document.querySelector(`[data-product-id="${productId}"]`);
                if (!productCard) {
                    log(`ERROR: Product card not found for ID: ${productId}`, 'error');
                    return;
                }
                
                log('Product card found, opening quickview...', 'info');
                
                // Show quick view sidebar
                const sidebar = document.getElementById('quick-view-sidebar');
                const overlay = document.getElementById('quick-view-overlay');
                
                if (sidebar && overlay) {
                    sidebar.classList.add('active');
                    overlay.classList.add('active');
                    log('Quickview sidebar and overlay activated', 'success');
                } else {
                    log('ERROR: Quickview sidebar or overlay not found', 'error');
                    return;
                }
                
                // Load product data directly from the card
                loadProductDataFromCard(productCard);
                
            } catch (error) {
                log(`ERROR in testQuickView: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }
        
        // Load product data from card
        function loadProductDataFromCard(productCard) {
            log('Loading product data from card...', 'info');
            
            try {
                // Extract data from the card's data attributes
                const productData = {
                    id: productCard.dataset.productId,
                    name: productCard.dataset.productName,
                    price: parseFloat(productCard.dataset.productPrice),
                    salePrice: productCard.dataset.productSalePrice ? parseFloat(productCard.dataset.productSalePrice) : null,
                    description: productCard.dataset.productDescription,
                    category: productCard.dataset.productCategory,
                    subcategory: productCard.dataset.productSubcategory,
                    featured: productCard.dataset.productFeatured === 'true',
                    onSale: productCard.dataset.productOnSale === 'true',
                    stock: parseInt(productCard.dataset.productStock),
                    rating: parseFloat(productCard.dataset.productRating),
                    reviewCount: parseInt(productCard.dataset.productReviewCount),
                    frontImage: productCard.dataset.productFrontImage,
                    backImage: productCard.dataset.productBackImage,
                    color: productCard.dataset.productColor,
                    images: JSON.parse(productCard.dataset.productImages || '[]'),
                    colorVariants: JSON.parse(productCard.dataset.productColorVariants || '[]'),
                    sizes: JSON.parse(productCard.dataset.productSizes || '[]')
                };
                
                log('Product data extracted successfully', 'success');
                log(`Data summary: ${productData.name}, $${productData.price}, ${productData.images.length} images, ${productData.colorVariants.length} colors, ${productData.sizes.length} sizes`, 'info');
                
                // Format the data for quickview
                const formattedProduct = formatProductForQuickView(productData);
                
                // Populate the quickview
                populateQuickViewWithData(formattedProduct);
                
            } catch (error) {
                log(`ERROR loading product data from card: ${error.message}`, 'error');
                console.error('Full error:', error);
                showQuickViewError('Error reading product data from card: ' + error.message);
            }
        }
        
        // Format product for quickview
        function formatProductForQuickView(productData) {
            log('Formatting product data for quickview...', 'info');
            
            const formatted = {
                id: productData.id,
                name: productData.name,
                price: productData.price,
                salePrice: productData.salePrice,
                description: productData.description,
                category: productData.category,
                subcategory: productData.subcategory,
                featured: productData.featured,
                onSale: productData.onSale,
                stock: productData.stock,
                rating: productData.rating,
                reviewCount: productData.reviewCount,
                images: [],
                colors: [],
                sizes: [],
                variants: []
            };
            
            // Process images
            if (productData.frontImage) {
                formatted.images.push({
                    src: productData.frontImage,
                    type: 'image',
                    alt: productData.name + ' - Front'
                });
            }
            
            if (productData.backImage) {
                formatted.images.push({
                    src: productData.backImage,
                    type: 'image',
                    alt: productData.name + ' - Back'
                });
            }
            
            // Add additional images
            if (productData.images && Array.isArray(productData.images)) {
                productData.images.forEach(img => {
                    if (img && typeof img === 'string') {
                        formatted.images.push({
                            src: img,
                            type: 'image',
                            alt: productData.name
                        });
                    }
                });
            }
            
            // Process colors
            if (productData.colorVariants && productData.colorVariants.length > 0) {
                productData.colorVariants.forEach(variant => {
                    const colorData = {
                        name: variant.color || 'Default',
                        value: variant.color || 'default',
                        hex: variant.hex || '#000000',
                        images: [],
                        sizes: [],
                        stock: variant.stock || 0
                    };
                    
                    // Add variant images
                    if (variant.front_image) {
                        colorData.images.push({
                            src: variant.front_image,
                            type: 'image',
                            alt: productData.name + ' - ' + colorData.name
                        });
                    }
                    
                    // Add variant sizes
                    if (variant.sizes && Array.isArray(variant.sizes)) {
                        variant.sizes.forEach(size => {
                            colorData.sizes.push({
                                name: size.size || 'One Size',
                                available: size.available !== false,
                                stock: size.stock || 0
                            });
                        });
                    }
                    
                    formatted.colors.push(colorData);
                });
            } else {
                // Basic color
                formatted.colors.push({
                    name: 'Available',
                    value: 'available',
                    hex: productData.color || '#000000',
                    images: formatted.images,
                    sizes: [],
                    stock: productData.stock
                });
            }
            
            // Process sizes
            if (productData.sizes && productData.sizes.length > 0) {
                formatted.sizes = productData.sizes.map(size => ({
                    name: size.size || size.name || 'One Size',
                    available: size.available !== false,
                    stock: size.stock || 0
                }));
            } else {
                // Default sizes
                const defaultSizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
                formatted.sizes = defaultSizes.map(size => ({
                    name: size,
                    available: true,
                    stock: productData.stock
                }));
            }
            
            // Set defaults
            if (formatted.colors.length > 0) {
                formatted.defaultColor = formatted.colors[0].value;
            }
            if (formatted.sizes.length > 0) {
                formatted.defaultSize = formatted.sizes[0].name;
            }
            
            log(`Formatted product: ${formatted.images.length} images, ${formatted.colors.length} colors, ${formatted.sizes.length} sizes`, 'success');
            return formatted;
        }
        
        // Populate quickview with data
        function populateQuickViewWithData(product) {
            log('Populating quickview with product data...', 'info');
            
            try {
                // Update title and basic info
                document.getElementById('quick-view-title').textContent = product.name;
                document.getElementById('quick-view-price').textContent = `$${product.price}`;
                
                if (product.salePrice) {
                    document.getElementById('quick-view-sale-price').textContent = `Sale: $${product.salePrice}`;
                    document.getElementById('quick-view-sale-price').style.display = 'block';
                } else {
                    document.getElementById('quick-view-sale-price').style.display = 'none';
                }
                
                document.getElementById('quick-view-description').textContent = product.description;
                
                // Update images
                const imagesContainer = document.getElementById('quick-view-images');
                imagesContainer.innerHTML = '';
                product.images.forEach(img => {
                    const imgEl = document.createElement('img');
                    imgEl.src = img.src;
                    imgEl.alt = img.alt;
                    imgEl.style.width = '80px';
                    imgEl.style.height = '80px';
                    imgEl.style.objectFit = 'cover';
                    imgEl.style.margin = '5px';
                    imgEl.style.borderRadius = '5px';
                    imagesContainer.appendChild(imgEl);
                });
                
                // Update colors
                const colorsContainer = document.getElementById('quick-view-colors');
                colorsContainer.innerHTML = '';
                product.colors.forEach(color => {
                    const colorEl = document.createElement('div');
                    colorEl.style.width = '30px';
                    colorEl.style.height = '30px';
                    colorEl.style.borderRadius = '50%';
                    colorEl.style.backgroundColor = color.hex;
                    colorEl.style.border = '2px solid #ddd';
                    colorEl.style.margin = '5px';
                    colorEl.style.display = 'inline-block';
                    colorEl.title = color.name;
                    colorsContainer.appendChild(colorEl);
                });
                
                // Update sizes
                const sizesContainer = document.getElementById('quick-view-sizes');
                sizesContainer.innerHTML = '';
                product.sizes.forEach(size => {
                    const sizeEl = document.createElement('div');
                    sizeEl.style.padding = '5px 10px';
                    sizeEl.style.border = '1px solid #ddd';
                    sizeEl.style.borderRadius = '3px';
                    sizeEl.style.margin = '5px';
                    sizeEl.style.display = 'inline-block';
                    sizeEl.style.backgroundColor = size.available ? '#e8f5e8' : '#f5e5e5';
                    sizeEl.textContent = size.name;
                    sizeEl.title = `${size.name} - Stock: ${size.stock}`;
                    sizesContainer.appendChild(sizeEl);
                });
                
                // Show raw data
                document.getElementById('quick-view-raw-data').textContent = JSON.stringify(product, null, 2);
                
                log('Quickview populated successfully!', 'success');
                
            } catch (error) {
                log(`ERROR populating quickview: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }
        
        // Show error
        function showQuickViewError(message) {
            log(`ERROR: ${message}`, 'error');
            document.getElementById('quick-view-title').textContent = 'Error';
            document.getElementById('quick-view-description').textContent = message;
        }
        
        // Close quickview
        function closeQuickView() {
            const sidebar = document.getElementById('quick-view-sidebar');
            const overlay = document.getElementById('quick-view-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                log('Quickview closed', 'info');
            }
        }
        
        // Clear debug log
        function clearDebugLog() {
            document.getElementById('debug-log').textContent = 'Debug log cleared...\n';
            log('Debug log cleared', 'info');
        }
        
        // Close quickview when clicking overlay
        document.getElementById('quick-view-overlay').addEventListener('click', closeQuickView);
        
        // Initial log
        log('Debug page loaded successfully', 'success');
        log('Click "Test Data Extraction" to check if data attributes are working', 'info');
        log('Click "Test Quickview" to test the full quickview functionality', 'info');
    </script>
</body>
</html>

