<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Women's Quickview</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { 
            border: 2px solid #ddd; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
        }
        .product-card { 
            border: 1px solid #007bff; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
            background: #f8f9fa;
        }
        .quick-view {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        .quick-view:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Women's Quickview</h1>
    
    <div class="test-section">
        <h2>üìã Test Instructions</h2>
        <ol>
            <li>Click "Quick View" button below</li>
            <li>Check if the quickview sidebar opens</li>
            <li>Look for any JavaScript errors in the browser console (F12)</li>
            <li>Tell me what you see and any error messages</li>
        </ol>
    </div>
    
    <!-- Test Product Card -->
    <div class="product-card" 
         data-product-id="test-women-123"
         data-product-name="Test Women's Dress"
         data-product-price="89.99"
         data-product-sale-price="69.99"
         data-product-description="This is a beautiful test dress for women"
         data-product-category="Women's Clothing"
         data-product-subcategory="Dresses"
         data-product-featured="true"
         data-product-on-sale="true"
         data-product-stock="25"
         data-product-rating="4.5"
         data-product-review-count="18"
         data-product-front-image="https://via.placeholder.com/300x400/ff6b6b/ffffff?text=Front"
         data-product-back-image="https://via.placeholder.com/300x400/4ecdc4/ffffff?text=Back"
         data-product-color="#ff6b6b"
         data-product-images='["https://via.placeholder.com/300x400/45b7d1/ffffff?text=Image1"]'
         data-product-color-variants='[{"color":"Red","value":"red","hex":"#ff6b6b","front_image":"https://via.placeholder.com/300x400/ff6b6b/ffffff?text=Red+Front","sizes":[{"size":"S","available":true,"stock":8},{"size":"M","available":true,"stock":12},{"size":"L","available":true,"stock":5}],"stock":25}]'
         data-product-sizes='[{"size":"S","available":true,"stock":8},{"size":"M","available":true,"stock":12},{"size":"L","available":true,"stock":5}]'
         data-product-variants='[]'
         data-product-product-variants='[]'
         data-product-options='[]'
         data-product-product-options='[]'
         data-product-image-front="https://via.placeholder.com/300x400/ff6b6b/ffffff?text=Legacy+Front"
         data-product-image-back="https://via.placeholder.com/300x400/4ecdc4/ffffff?text=Legacy+Back">
        
        <h3>Test Women's Dress</h3>
        <p>Price: $89.99 (Sale: $69.99)</p>
        <p>Stock: 25</p>
        <p>Rating: 4.5 (18 reviews)</p>
        
        <button class="quick-view" data-product-id="test-women-123">
            Quick View
        </button>
    </div>
    
    <!-- Quick View Sidebar -->
    <div id="quick-view-sidebar" class="quickview-sidebar">
        <button class="close-btn" onclick="closeQuickView()">√ó</button>
        <div class="quickview-content">
            <div class="product-images">
                <div class="main-image">
                    <img id="quick-view-main-image" src="" alt="">
                </div>
                <div class="image-thumbnails" id="quick-view-thumbnails"></div>
            </div>
            
            <div class="product-info">
                <h2 id="quick-view-title"></h2>
                <div class="price-section">
                    <span id="quick-view-price" class="price"></span>
                    <span id="quick-view-sale-price" class="sale-price" style="display: none;"></span>
                </div>
                
                <div class="rating-section">
                    <div class="stars" id="quick-view-stars"></div>
                    <span id="quick-view-review-count"></span>
                </div>
                
                <p id="quick-view-description"></p>
                
                <div class="color-section">
                    <h4>Color:</h4>
                    <div class="color-options" id="quick-view-colors"></div>
                </div>
                
                <div class="size-section">
                    <h4>Size:</h4>
                    <div class="size-options" id="quick-view-sizes"></div>
                </div>
                
                <div class="quantity-section">
                    <label for="quick-view-quantity">Quantity:</label>
                    <input type="number" id="quick-view-quantity" value="1" min="1" max="99">
                </div>
                
                <div class="action-buttons">
                    <button id="quick-view-add-to-cart" class="add-to-cart-btn">Add to Cart</button>
                    <button id="quick-view-add-to-wishlist" class="wishlist-btn">
                        ‚ù§Ô∏è Add to Wishlist
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Overlay -->
    <div id="quick-view-overlay" class="quickview-overlay"></div>
    
    <!-- Quickview CSS -->
    <style>
        .quickview-sidebar {
            position: fixed;
            right: -500px;
            top: 0;
            width: 500px;
            height: 100vh;
            background: white;
            border-left: 1px solid #ddd;
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
        }
        
        .quickview-sidebar.active {
            right: 0;
        }
        
        .quickview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .quickview-overlay.active {
            display: block;
        }
        
        .quickview-content {
            padding: 20px;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff4444;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: #cc0000;
        }
        
        .product-images {
            margin-bottom: 20px;
        }
        
        .main-image {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .main-image img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        .image-thumbnails {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .image-thumbnails img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        
        .image-thumbnails img:hover,
        .image-thumbnails img.active {
            border-color: #007bff;
        }
        
        .product-info h2 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 24px;
        }
        
        .price-section {
            margin-bottom: 15px;
        }
        
        .price {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        .sale-price {
            font-size: 18px;
            color: #ff4444;
            margin-left: 10px;
            text-decoration: line-through;
        }
        
        .rating-section {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stars {
            color: #ffc107;
            font-size: 18px;
        }
        
        .review-count {
            color: #666;
            font-size: 14px;
        }
        
        #quick-view-description {
            margin-bottom: 20px;
            color: #666;
            line-height: 1.6;
        }
        
        .color-section,
        .size-section {
            margin-bottom: 20px;
        }
        
        .color-section h4,
        .size-section h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }
        
        .color-options,
        .size-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        
        .color-option:hover,
        .color-option.selected {
            border-color: #007bff;
        }
        
        .size-option {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }
        
        .size-option:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }
        
        .size-option.selected {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }
        
        .size-option.unavailable {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }
        
        .quantity-section {
            margin-bottom: 20px;
        }
        
        .quantity-section label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        #quick-view-quantity {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .add-to-cart-btn,
        .wishlist-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .add-to-cart-btn {
            background: #007bff;
            color: white;
        }
        
        .add-to-cart-btn:hover {
            background: #0056b3;
        }
        
        .wishlist-btn {
            background: #ff4444;
            color: white;
        }
        
        .wishlist-btn:hover {
            background: #cc0000;
        }
        
        .wishlist-btn i {
            margin-right: 5px;
        }
        
        @media (max-width: 768px) {
            .quickview-sidebar {
                width: 100%;
                right: -100%;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
    
    <!-- Quickview JavaScript -->
    <script>
        // Quick View functionality
        const sidebar = document.getElementById('quick-view-sidebar');
        const overlay = document.getElementById('quick-view-overlay');
        
        console.log('Quick view elements found:', {
            sidebar: !!sidebar,
            overlay: !!overlay
        });
        
        // Quick View button click handler
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('quick-view') || e.target.closest('.quick-view')) {
                e.preventDefault();
                console.log('Quick view button clicked!');
                const button = e.target.classList.contains('quick-view') ? e.target : e.target.closest('.quick-view');
                const productId = button.getAttribute('data-product-id');
                console.log('Product ID:', productId);
                if (productId) {
                    openQuickView(productId);
                } else {
                    console.error('No product ID found');
                }
            }
        });
        
        // Close quick view
        if (overlay) overlay.addEventListener('click', closeQuickView);
        
        function openQuickView(productId) {
            console.log('Opening quick view for:', productId);
            
            // Find the product card that was clicked
            const productCard = document.querySelector(`[data-product-id="${productId}"]`);
            if (!productCard) {
                console.error('Product card not found for ID:', productId);
                return;
            }
            
            // Show quick view sidebar
            if (sidebar && overlay) {
                sidebar.classList.add('active');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            // Load product data directly from the card
            loadProductDataFromCard(productCard);
        }
        
        function loadProductDataFromCard(productCard) {
            console.log('Loading product data from card:', productCard);
            
            try {
                // Extract data from the card's data attributes
                const productData = {
                    id: productCard.dataset.productId,
                    name: productCard.dataset.productName,
                    price: parseFloat(productCard.dataset.productPrice),
                    salePrice: productCard.dataset.productSalePrice ? parseFloat(productCard.dataset.productSalePrice) : null,
                    description: productCard.dataset.productDescription,
                    category: productCard.dataset.productCategory,
                    subcategory: productCard.dataset.productSubcategory,
                    featured: productCard.dataset.productFeatured === 'true',
                    onSale: productCard.dataset.productOnSale === 'true',
                    stock: parseInt(productCard.dataset.productStock),
                    rating: parseFloat(productCard.dataset.productRating),
                    reviewCount: parseInt(productCard.dataset.productReviewCount),
                    frontImage: productCard.dataset.productFrontImage,
                    backImage: productCard.dataset.productBackImage,
                    color: productCard.dataset.productColor,
                    images: JSON.parse(productCard.dataset.productImages || '[]'),
                    colorVariants: JSON.parse(productCard.dataset.productColorVariants || '[]'),
                    sizes: JSON.parse(productCard.dataset.productSizes || '[]'),
                    variants: JSON.parse(productCard.dataset.productVariants || '[]'),
                    productVariants: JSON.parse(productCard.dataset.productProductVariants || '[]'),
                    options: JSON.parse(productCard.dataset.productOptions || '[]'),
                    productOptions: JSON.parse(productCard.dataset.productProductOptions || '[]'),
                    imageFront: productCard.dataset.productImageFront,
                    imageBack: productCard.dataset.productImageBack
                };
                
                console.log('Product data extracted from card:', productData);
                
                // Format the data for quickview
                const formattedProduct = formatProductForQuickView(productData);
                
                // Populate the quickview
                populateQuickViewWithData(formattedProduct);
                
            } catch (error) {
                console.error('Error loading product data from card:', error);
                showQuickViewError('Error reading product data from card: ' + error.message);
            }
        }
        
        function formatProductForQuickView(productData) {
            console.log('Formatting product data for quickview:', productData);
            
            const formatted = {
                id: productData.id,
                name: productData.name,
                price: productData.price,
                salePrice: productData.salePrice,
                description: productData.description,
                category: productData.category,
                subcategory: productData.subcategory,
                featured: productData.featured,
                onSale: productData.onSale,
                stock: productData.stock,
                rating: productData.rating,
                reviewCount: productData.reviewCount,
                images: [],
                colors: [],
                sizes: [],
                variants: []
            };
            
            // Process images
            if (productData.frontImage) {
                formatted.images.push({
                    src: productData.frontImage,
                    type: 'image',
                    alt: productData.name + ' - Front'
                });
            }
            
            if (productData.backImage) {
                formatted.images.push({
                    src: productData.backImage,
                    type: 'image',
                    alt: productData.name + ' - Back'
                });
            }
            
            // Add additional images
            if (productData.images && Array.isArray(productData.images)) {
                productData.images.forEach(img => {
                    if (img && typeof img === 'string') {
                        formatted.images.push({
                            src: img,
                            type: 'image',
                            alt: productData.name
                        });
                    }
                });
            }
            
            // Process colors
            if (productData.colorVariants && productData.colorVariants.length > 0) {
                productData.colorVariants.forEach(variant => {
                    const colorData = {
                        name: variant.color || 'Default',
                        value: variant.color || 'default',
                        hex: variant.hex || '#000000',
                        images: [],
                        sizes: [],
                        stock: variant.stock || 0
                    };
                    
                    // Add variant images
                    if (variant.front_image) {
                        colorData.images.push({
                            src: variant.front_image,
                            type: 'image',
                            alt: productData.name + ' - ' + colorData.name
                        });
                    }
                    
                    // Add variant sizes
                    if (variant.sizes && Array.isArray(variant.sizes)) {
                        variant.sizes.forEach(size => {
                            colorData.sizes.push({
                                name: size.size || 'One Size',
                                available: size.available !== false,
                                stock: size.stock || 0
                            });
                        });
                    }
                    
                    formatted.colors.push(colorData);
                });
            } else {
                // Basic color
                formatted.colors.push({
                    name: 'Available',
                    value: 'available',
                    hex: productData.color || '#000000',
                    images: formatted.images,
                    sizes: [],
                    stock: productData.stock
                });
            }
            
            // Process sizes
            if (productData.sizes && productData.sizes.length > 0) {
                formatted.sizes = productData.sizes.map(size => ({
                    name: size.size || size.name || 'One Size',
                    available: size.available !== false,
                    stock: size.stock || 0
                }));
            } else {
                // Default sizes
                const defaultSizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
                formatted.sizes = defaultSizes.map(size => ({
                    name: size,
                    available: true,
                    stock: productData.stock
                }));
            }
            
            // Set defaults
            if (formatted.colors.length > 0) {
                formatted.defaultColor = formatted.colors[0].value;
            }
            if (formatted.sizes.length > 0) {
                formatted.defaultSize = formatted.sizes[0].name;
            }
            
            console.log('Formatted product for quickview:', formatted);
            return formatted;
        }
        
        function populateQuickViewWithData(product) {
            console.log('Populating quickview with product data...');
            
            try {
                // Update title and basic info
                document.getElementById('quick-view-title').textContent = product.name;
                document.getElementById('quick-view-price').textContent = `$${product.price}`;
                
                if (product.salePrice) {
                    document.getElementById('quick-view-sale-price').textContent = `Sale: $${product.salePrice}`;
                    document.getElementById('quick-view-sale-price').style.display = 'block';
                } else {
                    document.getElementById('quick-view-sale-price').style.display = 'none';
                }
                
                document.getElementById('quick-view-description').textContent = product.description;
                
                // Update rating
                const stars = '‚òÖ'.repeat(Math.floor(product.rating)) + '‚òÜ'.repeat(5 - Math.floor(product.rating));
                document.getElementById('quick-view-stars').textContent = stars;
                document.getElementById('quick-view-review-count').textContent = `(${product.reviewCount} reviews)`;
                
                // Update main image
                if (product.images.length > 0) {
                    const mainImage = document.getElementById('quick-view-main-image');
                    mainImage.src = product.images[0].src;
                    mainImage.alt = product.images[0].alt;
                    mainImage.style.display = 'block';
                }
                
                // Update thumbnails
                const thumbnailsContainer = document.getElementById('quick-view-thumbnails');
                thumbnailsContainer.innerHTML = '';
                product.images.forEach((img, index) => {
                    const imgEl = document.createElement('img');
                    imgEl.src = img.src;
                    imgEl.alt = img.alt;
                    imgEl.className = index === 0 ? 'active' : '';
                    imgEl.onclick = () => {
                        // Update main image
                        document.getElementById('quick-view-main-image').src = img.src;
                        document.getElementById('quick-view-main-image').alt = img.alt;
                        // Update active thumbnail
                        thumbnailsContainer.querySelectorAll('img').forEach(t => t.classList.remove('active'));
                        imgEl.classList.add('active');
                    };
                    thumbnailsContainer.appendChild(imgEl);
                });
                
                // Update colors
                const colorsContainer = document.getElementById('quick-view-colors');
                colorsContainer.innerHTML = '';
                product.colors.forEach(color => {
                    const colorEl = document.createElement('div');
                    colorEl.className = 'color-option';
                    colorEl.style.backgroundColor = color.hex;
                    colorEl.title = color.name;
                    colorEl.onclick = () => {
                        // Update selected color
                        colorsContainer.querySelectorAll('.color-option').forEach(c => c.classList.remove('selected'));
                        colorEl.classList.add('selected');
                    };
                    colorsContainer.appendChild(colorEl);
                });
                
                // Update sizes
                const sizesContainer = document.getElementById('quick-view-sizes');
                sizesContainer.innerHTML = '';
                product.sizes.forEach(size => {
                    const sizeEl = document.createElement('div');
                    sizeEl.className = size.available ? 'size-option' : 'size-option unavailable';
                    sizeEl.textContent = size.name;
                    sizeEl.title = `${size.name} - Stock: ${size.stock}`;
                    if (size.available) {
                        sizeEl.onclick = () => {
                            // Update selected size
                            sizesContainer.querySelectorAll('.size-option').forEach(s => s.classList.remove('selected'));
                            sizeEl.classList.add('selected');
                        };
                    }
                    sizesContainer.appendChild(sizeEl);
                });
                
                console.log('Quickview populated successfully!');
                
            } catch (error) {
                console.error('Error populating quickview:', error);
                showQuickViewError('Error populating quickview: ' + error.message);
            }
        }
        
        function showQuickViewError(message) {
            console.error('Quickview error:', message);
            document.getElementById('quick-view-title').textContent = 'Error';
            document.getElementById('quick-view-description').textContent = message;
        }
        
        function closeQuickView() {
            if (sidebar && overlay) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        console.log('Test page loaded successfully');
        console.log('Click the Quick View button to test the functionality');
    </script>
</body>
</html>

